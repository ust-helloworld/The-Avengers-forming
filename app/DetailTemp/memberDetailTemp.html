<html ng-app = "teamform-memberDetail-app">
<head> 
<title>Profile testing</title> 

    <!-- Customized libraries shared by pages -->
    <script src="../js/site.js"></script>
	<!-- Angular and Angular-route libraries (v1.5.7) -->
    <script src="../lib/angular.min.js"></script>
    <script src="../lib/angular-route.min.js"></script>
    <!-- Firebase (v3.0.3) and AngularFire (v2.0.0) (after angular library is loaded) -->
    <script src="../lib/firebase.js"></script>     
    <script src="../lib/angularfire.min.js"></script>

</head>
<body>

<div id = "YourProfile" ng-controller = "ProfileAcc" class="text-center">
  Please input your data:)<br>Use UserID and activity to access data from database.<br>
  <form id = "ProfileForm">
    <label>Your UserId:<input type=text ng-model = "FUID"></label><br>
    <label>Your Name:<input type=text ng-model = "Fname"></label><br>
    <label>You are well-known in :<input type=text ng-model = "Fskill"></label><br>
    <label>You apply for activity: <input type = text ng-model = "activity"></label><br>
	<label>Your description : <textarea ng-model = "description"></textarea><br>
	<label> You received group invitation for : <span ng-repeat = "xinvite in inviteReceived" ng-click = "accept(xinvite)">{{xinvite}}  </span></label><br>
    <input type = "button" ng-click = "load()" value = "load"> <input type = "button" ng-click = "save()" value = "save">
  </form>
  <div id = "testing_ouput">
    {{ datadebug | json}}
	<div ng-repeat = "comment in comments">
	  Comment: {{comment}}
	</div>
  </div>
   
 </div>
   

<script>
   
angular.module('teamform-memberDetail-app',['firebase'])
.controller('ProfileAcc',  ['$scope', '$firebaseObject', '$firebaseArray',function($scope) {

  //initalizeFirebase();
  initalizeFirebase();
  database = firebase.database();
  
  $scope.FUID = "ng";
  $scope.Fname = "";
  $scope.Fskill = "";
  $scope.datadebug = {
    name: $scope.Fname,
    skill: $scope.Fskill
  };
  $scope.inviteReceived = [];
  
  $scope.load = function () {
    alert ("click load :P");
    FUID = $scope.FUID;
    if ( FUID !== '' ) {
  
      var refPath = "/user/"+FUID;
      alert (refPath);
      //This is the way for getting data from firebase
      //.once("value") <--the value inside value must be value;
      database.ref(refPath).once("value").then(function (data)
      {
        //here use data to get back the data :)
        if ( data.val().name != null ) {
          $scope.Fname = data.val().name;
        } else {
          $scope.Fname = "";
        }
        if ( data.val().skill != null ) {
          $scope.Fskill = data.val().skill;
        } else {
          $scope.Fskill = "";
        }
		if ( data.val().invite != null ) {
          $scope.inviteReceived = data.val().invite;
        } else {
          $scope.inviteReceived = "";
        }
		if ( data.val().comments != null ) {
          $scope.comments = data.val().comments;
        } else {
          $scope.comments = "";
        }
		if ( data.val().description != null ) {
          $scope.description = data.val().description;
        } else {
          $scope.description = "";
        }
        $scope.datadebug = {
        name: data.val().name,
        skill: data.val().skill
        };
		$scope.$apply();
      });
    }
  }
  $scope.save = function () {
    alert ("click save :P");
    FUID = $scope.FUID;
    Fname = $scope.Fname;
    Fskill = $scope.Fskill;
	description = $scope.description;
	if (typeof Fskill == "string")
	  skilllist = Fskill.split(',');
	else skilllist = Fskill;
    if ( FUID !== '') {
      
      var refPath = "/user/"+FUID;
      alert (refPath);
      //this is the method to set/rewrite the data inside firebase
	  updates = {};
	  updates["name"] = Fname;
	  updates["skill"] = skilllist;
	  updates["description"] = description;
      database.ref(refPath).update(updates);
      $scope.datadebug = {
        name: Fname,
        skill: skilllist
        
      };
    }
  };
  //<!-- wait for Robbie to do the accept function -->
  /*$scope.accept = function (para){
    FUID = $scope.FUID;
    activity = $scope.activity;
	alert("clicked accept");
	if ( FUID !== '' && activity !=='') {
	  refPath = activity +"/member/"+FUID;
	  updates = {'invite':null};
	  database.ref(refPath).update(updates);
	  refPath = activity + "/team/" + para;
	  database.ref(refPath).once("value").then(function (data)
      {
	    memberlist = data.val().teamMembers;
		if (memberlist == null) memberlist = [];
		alert("memberlist");
		memberlist.push(FUID);
		updates = {};
		updates["teamMembers"] = memberlist;
		database.ref(refPath).update(updates);
	  });
	}
  };*/
  

}]);
   
   </script>

</body>
</html>